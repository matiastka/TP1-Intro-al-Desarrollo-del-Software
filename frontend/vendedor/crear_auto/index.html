<!--Esta es página para crear un auto-->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CarTrader</title>

    <!--Para usar boostrap:-->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    

</head>
<body data-bs-theme="dark"> <!--Hacemos la página modo oscura (por Boostrap)-->
    <div class="container my-4">
        <div class="row">
            <div class="col-12 col-md-10 col-lg-6 mx-auto">
                <div class="card">
                    <div class="card-body">
                        <h2 class="card-title">Registrar Auto</h2> 
                        <form onsubmit="crear_auto(event)"> 
                            <div class="mb-3"> 
                                <label for="name" class="form-label">Nombre del auto</label>
                                <input type="text" class="form-control" id="nombre_auto" name="nombre_auto" placeholder="Ranger" required>
                            </div>

                            <div class="mb-3"> 
                                <label for="anio" class="form-label">Año</label>
                                <input type="number" class="form-control" id="anio" name="anio" placeholder="2015" required>
                            </div>

                            <div class="mb-3"> 
                                <label for="cant_asientos" class="form-label">Cantidad de asientos</label>
                                <input type="number" class="form-control" id="cant_asientos" name="cant_asientos" placeholder="5" required>
                            </div>

                            <label class="mb-3 me-3"> Tipo de caja: </label> 
                            <div class="form-check form-check-inline"> 
                                <input class="form-check-input" value="caja_automatica" type="radio" name="caja" id="caja_automatica" required>
                                <label class="form-check-label" for="caja_automatica">Caja automatica</label>
                            </div>
                            <div class="form-check form-check-inline">
                                <input class="form-check-input" value="caja_manual" type="radio" name="caja" id="caja_manual" required>
                                <label class="form-check-label" for="caja_manual">Caja manual</label>
                            </div>
                            
                            <br> 

                            <div class="mb-3"> 
                                <label for="color" class="form-label">Color</label>
                                <input type="text" class="form-control" id="color" name="color" placeholder="Rojo" required>
                            </div>
                            
                            <div class="mb-3"> 
                                <label for="kilometros" class="form-label">Kilometros</label>
                                <input type="number" class="form-control" id="kilometros" name="kilometros" placeholder="0" required>
                            </div>

                            <div class="mb-3"> 
                                <label for="link" class="form-label">Link de la imagen</label>
                                <input type="img" class="form-control" id="link" name="link" required>
                            </div>

                            <div class="mb-3"> 
                                <label for="marca" class="form-label">Marca</label>
                                <input type="text" class="form-control" id="marca" name="marca" placeholder="Fiat" required>
                            </div>

                            <div class="mb-3"> 
                                <label for="precio" class="form-label">Precio (USD)</label>
                                <input type="number" class="form-control" id="precio" name="precio" placeholder="1000" required>
                            </div>

                            <label for="baul mb-1">Tipo de Baúl</label> 
                            <select class="form-select mb-3" id="tipo_baul" name="tipo_baul">
                                <option value="grande">Grande</option>
                                <option value="mediano">Mediano</option>
                                <option value="chico">Chico</option>
                            </select>

                            <div class="mb-3"> 
                                <label for="ubicacion" class="form-label">Ubicación</label>
                                <input type="text" class="form-control" id="ubicacion" name="ubicacion" placeholder="CABA" required>
                            </div>

                            <button type="submit" class="btn btn-success">Crear</button>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
    <script>
        const parametros = new URLSearchParams(window.location.search); 
        const id = parametros.get("id"); 
        //console.log(id)

        function response_recibida(respuesta) { 
            return respuesta.json()
        }

        function manejar_error(error) {
            console.log("ERROR", error)
        }
 
        
        function crear_auto(event) { 
            event.preventDefault() 
            
            const formData = new FormData(event.target) 

            const nombre_auto = formData.get("nombre_auto")  // Creamos la constante nombre_auto que obtiene la data del formulario con id nombre_auto
            const anio = formData.get("anio") 
            const caja_automatica = formData.get("caja_automatica") // Idem con cada campo del formulario
            const caja_manual = formData.get("caja_manual") 
            const cant_asientos = formData.get("cant_asientos")
            const color = formData.get("color") 
            const kilometros = formData.get("kilometros") 
            const link = formData.get("link") 
            const marca = formData.get("marca") 
            const precio = formData.get("precio") 
            const tipo_baul = formData.get("tipo_baul") 
            const ubicacion = formData.get("ubicacion")

            // Función que brinda la respuesta que queremos del endpoint
            function crear_response(contenido) {
                console.log(contenido)
                if (contenido.Success === true) {
                    console.log(contenido)
                    console.log(contenido.autos)
                    console.log(contenido.autos.id)
                    alert("La publicación se ha editado con exito")
                    window.location.href = `/vendedor/auto?id_auto=${contenido.autos.id}&id=${id}` // Redireccionamos a la página del auto nuevo con su id y con el id del vendedor.
                }
                else {
                    alert("ERROR")
                }
            }          
            fetch((`http://localhost:5000/autos/`), {method: "POST", headers: {"Content-Type": "application/json"}, body: JSON.stringify({nombre_auto: nombre_auto,anio: anio,caja_automatica: caja_automatica,caja_manual: caja_manual,cant_asientos: cant_asientos,color: color,kilometros: kilometros,link: link,marca: marca,precio: precio,tipo_baul: tipo_baul,ubicacion: ubicacion, vendedor_id: id})
            }).then(response_recibida).then(crear_response).catch(manejar_error)
        }
    </script>
</body>
</html>